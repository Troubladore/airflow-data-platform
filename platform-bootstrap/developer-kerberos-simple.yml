# Simple Kerberos Ticket Sharing for WSL2
# =========================================
# Shares existing developer Kerberos tickets with Docker containers
# No custom image needed - just Alpine Linux with krb5

services:
  # Simple ticket sharing service
  kerberos-platform-service:
    image: alpine:latest
    container_name: kerberos-platform-service
    command: |
      sh -c "
        # Install Kerberos tools
        apk add --no-cache krb5 &&

        # Copy ticket from host mount to shared volume
        if [ -f /host/krb5cc_* ]; then
          cp /host/krb5cc_* /krb5/cache/krb5cc
          chmod 644 /krb5/cache/krb5cc
          echo 'Ticket shared to /krb5/cache/krb5cc'
        else
          echo 'No ticket found in /host/'
        fi &&

        # Keep container running and refresh periodically
        while true; do
          if [ -f /host/krb5cc_* ]; then
            cp /host/krb5cc_* /krb5/cache/krb5cc
          fi
          sleep 300
        done
      "

    volumes:
      # Mount WSL2 ticket cache location
      - ${HOME}/.krb5_cache:/host:ro

      # Shared volume for other containers
      - platform_kerberos_cache:/krb5/cache:rw

      # Use system krb5.conf
      - /etc/krb5.conf:/etc/krb5.conf:ro

    networks:
      - platform_network

volumes:
  platform_kerberos_cache:
    name: platform_kerberos_cache

networks:
  platform_network:
    name: platform_network
    driver: bridge
