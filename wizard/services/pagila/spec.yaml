service: pagila
version: 1.0
description: "Pagila sample database for PostgreSQL"
requires:
  - db.postgres
provides:
  - sample.pagila

steps:
  - id: check_existing_pagila
    type: action
    action: pagila.check_and_prompt_reinstall_pagila
    next: skip_install_check

  - id: skip_install_check
    type: conditional
    condition: services.pagila.skip_install
    when_true: END
    when_false: pagila_repo_url

  - id: pagila_repo_url
    type: string
    prompt: "Pagila repository URL:"
    state_key: services.pagila.repo_url
    default_from: services.pagila.repo_url
    default_value: https://github.com/Troubladore/pagila.git
    validator: pagila.validate_git_url
    next: pagila_branch

  - id: pagila_branch
    type: string
    prompt: "Pagila repository branch (leave empty for default):"
    state_key: services.pagila.branch
    default_from: services.pagila.branch
    default_value: ""
    next: pagila_postgres_image

  - id: pagila_postgres_image
    type: string
    prompt: "PostgreSQL Docker image for Pagila container:"
    state_key: services.pagila.postgres_image
    default_from: services.base_platform.postgres.image
    default_value: postgres:17.5-alpine
    validator: pagila.validate_postgres_image_url
    next: pagila_save

  - id: pagila_save
    type: action
    action: pagila.save_config
    next: pagila_install

  - id: pagila_install
    type: action
    action: pagila.install_pagila
    next: pagila_save_config

  - id: pagila_save_config
    type: action
    action: pagila.save_config
    next: finish
