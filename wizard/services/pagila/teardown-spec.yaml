service: pagila
version: 1.0
description: "Teardown Pagila sample database and cleanup"

steps:
  - id: pagila_teardown_confirm
    type: boolean
    prompt: "Confirm Pagila teardown?"
    state_key: services.pagila.teardown.confirm
    default_value: false
    next:
      when_value:
        true: show_details_header
        false: finish

  - id: show_details_header
    type: display
    prompt: |

      ────────────────────────────────────────────────────────
        Pagila Removal Options
      ────────────────────────────────────────────────────────

    next: stop_service

  - id: stop_service
    type: action
    action: pagila.stop_service
    next: pagila_remove_images_question

  - id: pagila_remove_images_question
    type: boolean
    prompt: "Remove Pagila Docker images?"
    state_key: services.pagila.teardown.remove_images
    default_value: false
    next:
      when_value:
        true: pagila_remove_images_action
        false: pagila_remove_repo_question

  - id: pagila_remove_images_action
    type: action
    action: pagila.remove_images
    next: pagila_remove_repo_question

  - id: pagila_remove_repo_question
    type: boolean
    prompt: "Remove cloned repository folder?"
    state_key: services.pagila.teardown.remove_repo
    default_value: false
    next:
      when_value:
        true: pagila_remove_repo_action
        false: pagila_remove_config_question

  - id: pagila_remove_repo_action
    type: action
    action: pagila.remove_repo
    next: pagila_remove_database_data_question

  - id: pagila_remove_database_data_question
    type: boolean
    prompt: "Remove Pagila database data (data will be lost)?"
    state_key: services.pagila.teardown.remove_database_data
    default_value: false
    next:
      when_value:
        true: pagila_remove_database_action
        false: pagila_remove_config_question

  - id: pagila_remove_database_action
    type: action
    action: pagila.drop_database
    next: pagila_remove_config_question

  - id: pagila_remove_config_question
    type: boolean
    prompt: "Remove from platform configuration (custom settings will be forgotten)?"
    state_key: services.pagila.teardown.remove_config
    default_value: false
    next:
      when_value:
        true: clean_config
        false: finish

  - id: clean_config
    type: action
    action: pagila.clean_config
    next: finish
