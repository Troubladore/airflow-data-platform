service: kerberos
version: "1.0"
description: "Kerberos authentication service setup"

provides:
  - kerberos

requires: []

steps:
  - id: detect_kerberos_action
    type: action
    action: kerberos.detect_configuration
    next: domain_input

  - id: domain_input
    type: string
    state_key: services.kerberos.domain
    default_from: services.kerberos.domain
    prompt: "Enter Kerberos domain (e.g., COMPANY.COM):"
    validator: kerberos.validate_domain
    next: use_prebuilt_input

  - id: use_prebuilt_input
    type: boolean
    state_key: services.kerberos.use_prebuilt
    default_from: services.kerberos.use_prebuilt
    prompt: "Will you use a prebuilt image with Kerberos packages already installed?"
    default_value: false
    next: image_input

  - id: image_input
    type: string
    state_key: services.kerberos.image
    default_from: services.kerberos.image
    prompt: "Enter Docker image for Kerberos (e.g., ubuntu:22.04 or mykerberos-image for prebuilt):"
    default_value: "ubuntu:22.04"
    validator: kerberos.validate_image_url
    next: test_kerberos_action

  - id: test_kerberos_action
    type: action
    action: kerberos.test_kerberos
    next: save_config_action

  - id: save_config_action
    type: action
    action: kerberos.save_config
    next: start_service_action

  - id: start_service_action
    type: action
    action: kerberos.start_service
    next: run_progressive_tests_prompt

  - id: run_progressive_tests_prompt
    type: boolean
    state_key: services.kerberos.run_progressive_tests
    prompt: "Would you like to run progressive connectivity tests? (recommended for first-time setup)"
    default_value: true
    next: progressive_tests_action

  - id: progressive_tests_action
    type: action
    action: kerberos.run_progressive_tests_conditional
    next: complete_section

  - id: complete_section
    type: action
    action: kerberos.complete_configuration
    next: finish
