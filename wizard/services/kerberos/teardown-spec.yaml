service: kerberos
version: "1.0"
description: "Kerberos authentication service teardown"

provides:
  - kerberos_teardown

requires:
  - kerberos

steps:
  - id: show_details_header
    type: display
    prompt: |

      ────────────────────────────────────────────────────────
        Kerberos Removal Options
      ────────────────────────────────────────────────────────

    next: stop_service

  - id: stop_service
    type: action
    action: kerberos.stop_service
    next: remove_images_question

  - id: remove_images_question
    type: boolean
    prompt: "Remove Kerberos Docker images?"
    state_key: services.kerberos.teardown.remove_images
    default_value: false
    next:
      when_value:
        true: remove_images_action
        false: remove_keytabs_question

  - id: remove_images_action
    type: action
    action: kerberos.remove_images
    next: remove_keytabs_question

  - id: remove_keytabs_question
    type: boolean
    prompt: "Remove keytab files?"
    state_key: services.kerberos.teardown.remove_keytabs
    default_value: false
    next:
      when_value:
        true: remove_keytabs_action
        false: remove_config_question

  - id: remove_keytabs_action
    type: action
    action: kerberos.remove_keytabs
    next: remove_config_question

  - id: remove_config_question
    type: boolean
    prompt: "Remove from platform configuration (custom settings will be forgotten)?"
    state_key: services.kerberos.teardown.remove_config
    default_value: false
    next:
      when_value:
        true: clean_config
        false: finish

  - id: clean_config
    type: action
    action: kerberos.clean_configuration
    next: finish
