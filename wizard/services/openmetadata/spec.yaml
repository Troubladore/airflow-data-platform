service: openmetadata
version: "1.0"
description: Data catalog and metadata management platform

requires:
  - db.postgres

provides:
  - metadata.catalog

steps:
  - id: server_image
    type: string
    prompt: "OpenMetadata server Docker image URL:"
    state_key: services.openmetadata.server_image
    default_from: services.openmetadata.server_image
    default_value: "docker.getcollate.io/openmetadata/server:1.5.0"
    validator: openmetadata.validate_image_url
    next: opensearch_image

  - id: opensearch_image
    type: string
    prompt: "OpenSearch Docker image URL:"
    state_key: services.openmetadata.opensearch_image
    default_from: services.openmetadata.opensearch_image
    default_value: "opensearchproject/opensearch:2.9.0"
    validator: openmetadata.validate_image_url
    next: port

  - id: port
    type: integer
    prompt: "OpenMetadata server port:"
    state_key: services.openmetadata.port
    default_from: services.openmetadata.port
    default_value: 8585
    validator: openmetadata.validate_port
    next: use_prebuilt

  - id: use_prebuilt
    type: boolean
    prompt: "Use prebuilt Docker images? (y/n):"
    state_key: services.openmetadata.use_prebuilt
    default_from: services.openmetadata.use_prebuilt
    default_value: true
    next: openmetadata_save

  - id: openmetadata_save
    type: action
    action: openmetadata.save_config
    next: openmetadata_start

  - id: openmetadata_start
    type: action
    action: openmetadata.start_service
    next: finish
